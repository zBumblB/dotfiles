#!/bin/sh

while getopts "p" arg; do
	case ${arg} in
		p) perm=1 ;;
		*) exit 1
	esac
done

shift $((OPTIND - 1))

newbg="$WALLPAPER"
[ -e "$1" ] && newbg="$1" 

[ -d "$newbg" ] && newbg=$(find -L "$newbg" -iregex '.*.\(jpg\|jpeg\|png\|gif\)' -type f | shuf -n 1)


[ -n "$perm" ] && [ -f "$newbg" ] && (
	rm "$WALLPAPER"
	ln -s "$newbg" "$WALLPAPER"
)

[[ $(file --mime-type -bL "$newbg") =~ image/* ]] && (
	notify-send "Changing wallpaper..." "$newbg"
	xwallpaper --zoom "$newbg"
) && exit 0

notify-send "Error" "Failed to set wallpaper"
exit 1
